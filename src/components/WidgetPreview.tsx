
import React, { useState } from 'react';
import { WidgetConfig } from '@/lib/widgetUtils';
import { Facebook, Instagram, Twitter } from 'lucide-react';

interface WidgetPreviewProps {
  config: WidgetConfig;
}

const WidgetPreview: React.FC<WidgetPreviewProps> = ({ config }) => {
  const { type, position, primaryColor, size } = config;
  const [showChat, setShowChat] = useState(false);

  const sizeMap = {
    small: '50px',
    medium: '60px',
    large: '70px',
  };

  const buttonStyle = {
    width: sizeMap[size || 'medium'],
    height: sizeMap[size || 'medium'],
    backgroundColor: primaryColor || '#25D366',
    position: 'absolute',
    bottom: '20px',
    [position || 'right']: '20px',
    borderRadius: '50%',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
    cursor: 'pointer',
    transition: 'transform 0.3s ease, box-shadow 0.3s ease',
  } as React.CSSProperties;

  const chatWindowStyle = {
    position: 'absolute',
    bottom: '90px',
    [position || 'right']: '20px',
    width: '250px',
    height: '300px',
    backgroundColor: 'white',
    borderRadius: '10px',
    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
    transition: 'all 0.3s ease',
    opacity: showChat ? 1 : 0,
    transform: showChat ? 'translateY(0)' : 'translateY(20px)',
    visibility: showChat ? 'visible' : 'hidden',
    display: 'flex',
    flexDirection: 'column',
  } as React.CSSProperties;

  const WhatsAppIcon = ({ size }: { size: number }) => (
    <svg width={size} height={size} viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
      <path fillRule="evenodd" clipRule="evenodd" d="M20.5027 3.5C16.2915 -0.692737 9.40034 -0.701884 5.17469 3.47355C0.949036 7.64899 0.894242 14.5502 5.02929 18.7883L5.15462 18.9172L3.50103 24L8.72647 22.4633L8.8518 22.5812C10.4854 23.5269 12.2891 24 14.1038 24C16.0274 24 17.8422 23.5159 19.4867 22.4853C23.7179 19.3614 24.7229 13.5162 21.7837 9.2175C21.459 8.72836 21.0452 8.23921 20.5027 3.5ZM14.1038 22.0317C12.4594 22.0317 10.8369 21.5976 9.41244 20.7293L9.11867 20.5704L5.95595 21.548L6.95093 18.4791L6.76647 18.1763C4.01927 13.8445 5.16374 8.16866 9.47635 5.44117C13.789 2.71367 19.4977 3.85601 22.2504 8.18777C24.9977 12.5195 23.8531 18.1953 19.5405 20.9228C17.9016 21.6599 16.0274 22.0317 14.1038 22.0317ZM17.1905 14.3912C16.9501 14.4132 16.4966 14.5392 15.1775 15.0394C14.0824 15.4551 11.5842 16.7457 11.4427 16.8166C11.1925 16.9316 11.0172 16.9426 10.784 16.7127C10.5399 16.4609 9.18592 15.3402 9.00146 15.1813C8.75736 14.9625 8.26392 14.7437 7.98928 15.0614C7.84483 15.2142 7.20619 15.8083 6.95096 16.0492C6.69686 16.2899 6.06934 15.9541 5.694 15.7462C5.10137 15.4441 3.76829 14.8391 3.75717 14.8281C2.46952 13.9158 1.72257 12.6911 2.08793 11.7788C2.35144 11.1628 2.74793 10.8168 3.13329 10.5367C3.40793 10.3288 3.75717 10.5367 3.93051 10.7005C4.55803 11.34 5.12953 12.0114 5.46762 12.186C5.81686 12.3709 6.05984 12.0331 6.30393 11.6833C6.42724 11.5022 6.57169 11.2771 6.63561 11.2001C6.81898 11.0143 6.69686 10.7775 6.63561 10.6736C6.46339 10.3728 5.90301 9.40511 5.67115 8.94778C5.34419 8.30566 4.9749 8.47196 4.62567 8.45001C4.43018 8.45001 3.98437 8.43713 3.58676 8.43713C2.64622 8.4262 1.92038 9.04637 1.59341 9.39221C0.873514 10.1406 0.526123 11.131 0.526123 12.3326C0.526123 13.7582 1.38176 15.546 1.6813 15.9908C2.1191 16.6 4.20888 19.9383 7.71464 21.1398C8.82084 21.5996 9.69648 21.8074 10.3796 21.9552C11.4313 22.1742 12.3832 22.1191 13.139 22.0537C13.9726 21.9772 15.9126 21.259 16.1529 20.6938C16.3807 20.0297 16.3918 19.4687 16.327 19.3428C16.2511 19.1899 16.0398 19.103 15.7432 18.9291C15.1994 18.6051 12.6353 17.3584 12.151 17.1833C11.7867 17.0573 11.5957 17.1063 11.3114 17.4521C11.1504 17.6489 10.7106 18.156 10.5176 18.3639C10.2429 18.6598 9.91599 18.5888 9.62023 18.4629C9.28213 18.326 8.32046 18.0239 7.66071 17.431C6.87815 16.7347 6.35358 15.854 6.15797 15.5629C6.05984 15.4111 6.11552 15.3511 6.17676 15.293C6.23243 15.235 6.31388 15.1313 6.396 15.0614C6.47856 14.9914 6.54981 14.9215 6.61106 14.8735C6.74431 14.7806 6.87815 14.6327 7.00086 14.5077C7.12458 14.3828 7.2483 14.2019 7.31511 14.077C7.38193 13.9521 7.46337 13.7662 7.38193 13.5913C7.30048 13.4223 6.74431 11.9198 6.55983 11.5132C6.38647 11.1067 6.2021 11.1517 6.05984 11.1517C5.97838 11.1517 5.87913 11.1407 5.779 11.1407C5.68 11.1407 5.5022 11.1188 5.34419 11.1188C5.17526 11.1188 4.93228 11.1957 4.68819 11.4146C4.45521 11.6334 3.78344 12.2494 3.78345 13.7641C3.78345 15.2776 4.87731 16.7017 5.02064 16.8826C5.16399 17.0695 6.84479 19.7976 9.57569 20.9552C10.2873 21.2361 10.8435 21.4001 11.2799 21.5271C12.0025 21.707 12.6698 21.685 13.194 21.612C13.785 21.5391 14.9319 20.9989 15.1163 20.4708C15.3007 19.9428 15.3007 19.4907 15.2339 19.3867C15.1724 19.2937 15.0019 19.2347 14.7493 19.1428C14.3852 18.9841 12.8052 18.2356 12.4716 18.1237C12.1379 18.0118 11.9091 18.0228 11.6650 18.2747C11.4209 18.5376 10.8369 19.0257 10.6478 19.3097C10.4373 19.6226 10.2099 19.5966 9.95583 19.4937C9.71824 19.3922 8.91047 19.1198 8.21783 18.5166C7.52533 17.9086 7.07622 17.1398 6.86705 16.7987C6.66068 16.4574 6.84063 16.2599 6.99553 16.0799C7.13832 15.9057 7.31623 15.6436 7.49515 15.4661C7.64766 15.3107 7.70333 15.2078 7.77457 15.0829C7.8347 14.958 7.78459 14.7831 7.72333 14.6582C7.65097 14.5333 7.18603 13.1337 6.95094 12.3326C6.71585 11.5315 6.48632 11.6124 6.2867 11.6014C6.10334 11.5904 5.88147 11.5904 5.6596 11.5904C5.43773 11.5904 5.06236 11.6564 4.74653 11.9531C4.4307 12.2498 3.68375 12.9542 3.68375 14.4349C3.68375 15.9156 4.85507 17.4183 5.01842 17.6262C5.17065 17.8231 7.0792 20.6719 10.0348 21.9003C10.8017 22.2022 11.4202 22.3831 11.9041 22.511C12.7043 22.7189 13.4345 22.6969 14.0176 22.632C14.6672 22.545 15.9437 21.9112 16.1391 21.3282C16.3401 20.7343 16.3401 20.2372 16.2677 20.1333C16.1953 20.0294 16.0178 19.9704 15.7542 19.8675C15.4517 19.7526 13.6815 18.924 13.3344 18.8121C13.0418 18.7111 12.8018 18.7001 12.5467 18.954C12.2424 19.252 11.8459 19.7415 11.6348 19.9731C11.4246 20.2101 11.1743 20.1662 10.9254 20.0633C10.6765 19.9594 9.82662 19.6683 9.09638 19.0304C8.36614 18.3925 7.89453 17.5864 7.67833 17.2348C7.46213 16.8832 7.65762 16.6753 7.82009 16.5175C7.97137 16.3717 8.16074 16.1528 8.32845 16.0159C8.49056 15.8792 8.55181 15.7652 8.6298 15.6403C8.70013 15.5153 8.65002 15.3404 8.59988 15.2255C8.54863 15.1106 8.18439 14.0899 7.97932 13.5399C7.80596 13.0278 7.60489 13.0388 7.43711 13.0388C7.28153 13.0278 7.10818 13.0278 6.9404 13.0278C6.76705 13.0278 6.49798 13.0828 6.26289 13.3236C6.0278 13.5644 5.37916 14.1695 5.37916 15.5812C5.37916 16.994 6.44411 18.3716 6.5897 18.5465C6.72416 18.7433 8.87783 22.0317 12.2496 23.1884C13.0712 23.5059 13.7177 23.667 14.2117 23.7898C15.0732 23.9977 15.8558 23.9758 16.4723 23.9108C17.1611 23.8348 18.4098 23.286 18.6051 22.6108C18.8113 21.9248 18.8114 21.3308 18.7446 21.2159C18.6778 21.101 18.4934 21.042 18.2184 20.9381C17.9544 20.8341 16.0622 19.9108 15.7239 19.7859C15.3857 19.6609 15.1749 19.6829 14.9069 19.9348C14.6401 20.1867 14.0115 20.7376 13.8203 20.9895C13.6323 21.2414 13.4056 21.2414 13.1704 21.1375C12.9296 21.0336 12.0781 20.7425 11.3535 20.0935C10.5966 19.4336 10.1126 18.6116 9.92478 18.2709C9.73035 17.9304 9.9181 17.7335 10.0714 17.5586C10.2471 17.3508 10.418 17.1649 10.5956 16.999C10.7621 16.8523 10.8345 16.7484 10.9121 16.6115C10.9899 16.4856 10.9288 16.3167 10.8732 16.1918C10.8175 16.0669 10.4654 15.046 10.2526 14.505C10.0399 13.964 9.81595 14.045 9.63702 14.034C9.46923 14.023 9.29589 14.023 9.12254 14.023C8.9492 14.023 8.66901 14.077 8.41934 14.3288C8.17525 14.5697 7.49128 15.2078 7.49128 16.6974C7.49128 18.187 8.61859 19.6279 8.77419 19.8358C8.92978 20.0436 11.2965 23.6339 15.0046 24.9143C15.9071 25.2713 16.6372 25.4462 17.1976 25.564C17.6877 25.6611 18.155 25.6786 18.5445 25.651C18.985 25.6332 20.4655 25.0611 20.6773 24.3092C20.8891 23.5573 20.8891 22.9193 20.8223 22.8044C20.7555 22.6895 20.5711 22.6196 20.296 22.5157C20.0209 22.4118 18.3301 21.4884 17.9699 21.3745C17.6097 21.2605 17.3997 21.2825 17.12 21.5344C16.8625 21.7862 16.2783 22.3371 16.0662 22.589C15.8541 22.8409 15.6363 22.8409 15.3744 22.737C15.1124 22.633 14.0324 22.2573 13.0601 21.3854C12.0877 20.5134 11.4747 19.2608 11.2626 18.9311C11.0504 18.6013 11.2293 18.4154 11.4032 18.2296C11.5494 18.0657 11.7783 17.8139 11.9562 17.627C12.1339 17.4401 12.175 17.257 12.2327 17.1321C12.2958 17.0062 12.1974 16.8204 12.1528 16.7054C12.0835 16.5476 11.6202 15.2518 11.4257 14.7127C11.2478 14.2276 10.9231 14.3096 10.7386 14.2986C10.5819 14.2876 10.3975 14.2876 10.213 14.2876C10.0065 14.2876 9.74126 14.3536 9.4861 14.6054C9.2298 14.8573 8.4305 15.5602 8.4305 17.0624C8.4305 18.5657 9.59662 19.9493 9.75221 20.1681C9.9078 20.387 11.8066 23.6229 15.6475 24.7915C16.3667 25.0894 17.1856 25.212 17.8985 25.3589C18.4823 25.4792 19.2136 25.4737 19.7808 25.4187C20.3481 25.3636 21.5061 24.7245 21.6846 24.0616C21.8631 23.3986 21.8631 22.8375 21.7962 22.7226C21.7294 22.6076 21.5451 22.5377 21.27 22.4338C20.9948 22.3299 19.3096 21.3955 18.9272 21.2705C18.6618 21.1823 18.4041 21.2045 18.1698 21.4124C17.9079 21.6532 17.3515 22.1821 17.1282 22.423C16.9048 22.664 16.6983 22.6749 16.4364 22.5709C16.1744 22.467 15.3287 22.193 14.4299 21.4562C13.7081 20.8732 13.1962 20.156 13.0173 19.8372C12.8384 19.5184 13.009 19.347 13.1739 19.1712C13.3256 19.0203 13.5401 18.7664 13.6956 18.5796C13.8511 18.3927 13.9056 18.2447 13.9723 18.1188C14.039 17.9939 13.9723 17.808 13.9056 17.683C13.839 17.5581 13.3312 16.2072 13.0728 15.689C12.8384 15.2054 12.5931 15.2715 12.4141 15.2494C12.2575 15.2384 12.073 15.2274 11.8886 15.2274C11.704 15.2274 11.4257 15.2714 11.1971 15.5232C10.9686 15.775 10.2023 16.4779 10.2023 17.9801C10.2023 19.4823 11.2325 20.8659 11.3881 21.0858C11.5437 21.3046 14.1252 24.8518 17.863 25.6972C18.7242 25.9511 19.3759 26.0221 19.882 26.095C20.6577 26.1951 21.3602 26.156 21.9441 26.101C22.5279 26.046 23.5268 25.4839 23.7165 24.743C23.9061 24.0021 23.9061 23.419 23.8393 23.3041C23.7836 23.1572 23.5882 23.0763 23.313 22.9724L23.2906 22.9632C23.033 22.8645 21.4159 21.9579 21.0335 21.8439C20.6511 21.7299 20.4155 21.752 20.1536 22.0038C19.9028 22.2337 19.4006 22.7736 19.1772 23.0145C18.9538 23.2554 18.7118 23.2005 18.4499 23.1075C18.1996 23.0145 17.1905 22.6796 16.0732 21.7562C15.1774 21.0093 14.5823 20.069 14.3533 19.7052C14.1243 19.3413 14.3477 19.1554 14.5044 18.9805C14.6721 18.7946 14.8733 18.5427 15.0289 18.3559C15.1845 18.169 15.239 18.021 15.3057 17.8961C15.3724 17.7712 15.3057 17.5853 15.239 17.4603C15.181 17.3513 14.7463 16.2094 14.5323 15.7023C14.2979 15.2077 14.0524 15.2738 13.8734 15.2628C13.7054 15.2518 13.5432 15.2408 13.3811 15.2408C13.219 15.2408 12.9517 15.2518 12.7344 15.5036C12.5059 15.7664 11.673 16.5472 11.673 18.0494C11.673 19.5516 12.8142 20.9463 12.9698 21.1761C13.1254 21.4059 15.8626 25.1694 19.4279 25.8144C20.2213 26.0113 20.9015 26.0823 21.4409 26.1552C22.0303 26.2334 22.6249 26.2124 23.1642 26.1572C23.7036 26.1021 24.7581 25.5501 24.9478 24.8092C25.1374 24.0683 25.1374 23.4852 25.0707 23.3703C25.0039 23.2553 24.8095 23.1844 24.5487 23.0804C24.288 22.9765 22.6806 22.0422 22.2982 21.9172C21.9158 21.7922 21.658 21.8252 21.4079 22.066C21.1467 22.3178 20.6223 22.8138 20.3989 23.0657C20.1866 23.3065 19.9445 23.2516 19.6826 23.1586C19.4207 23.0547 18.4055 22.7196 17.2881 21.7962C16.3922 21.0493 15.7972 20.109 15.5681 19.7452C15.3391 19.3813 15.5625 19.1954 15.7192 19.0205C15.887 18.8346 16.0916 18.5717 16.2472 18.3959C16.4028 18.22 16.4573 18.061 16.524 17.9361C16.5907 17.8112 16.524 17.6253 16.4573 17.5003C16.3907 17.3754 15.8718 16.0246 15.6019 15.4844C15.3498 15.0008 15.0989 15.0559 14.9199 15.0338C14.7407 15.0228 14.5562 15.0228 14.3717 15.0228C14.1872 15.0228 13.9087 15.0668 13.6803 15.3186C13.4518 15.5704 12.6855 16.2732 12.6855 17.7865C12.6855 19.2887 13.7268 20.6723 13.8713 20.8911C14.0158 21.11 16.381 25.1694 19.9749 25.9968C20.7968 26.2597 21.4632 26.3416 21.9748 26.4258C22.794 26.5507 23.5412 26.5058 24.1418 26.4507C24.7424 26.3957 25.7124 25.8436 25.8909 25.0697C26.0695 24.2958 26.0695 23.7127 26.0027 23.5868C25.9359 23.4718 25.7514 23.3898 25.4784 23.2859C25.2541 23.202 23.6968 22.3027 23.3145 22.1777C22.9321 22.0528 22.6743 22.0747 22.4124 22.3265C22.1616 22.5674 21.6593 23.1073 21.4359 23.3482C21.2125 23.5891 20.9816 23.542 20.7196 23.4381C20.4577 23.3342 19.3643 22.9222 18.3572 22.1201C17.5783 21.4952 17.0209 20.6742 16.8139 20.3544C16.6069 20.0345 16.8082 19.8597 16.987 19.6958C17.1436 19.5489 17.3224 19.363 17.4891 19.1881C17.6557 19.0133 17.7168 18.8763 17.7891 18.7514C17.8614 18.6265 17.8003 18.4737 17.7335 18.3597C17.6724 18.2578 17.1905 16.9511 16.9501 16.4072Z" fill="white"/>
    </svg>
  );

  const getIcon = () => {
    const iconSize = parseInt(sizeMap[size || 'medium'], 10) * 0.5;
    
    switch (type) {
      case 'whatsapp':
        return <WhatsAppIcon size={iconSize} />;
      case 'facebook':
        return <Facebook size={iconSize} color="white" />;
      case 'instagram':
        return <Instagram size={iconSize} color="white" />;
      case 'twitter':
        return <Twitter size={iconSize} color="white" />;
      default:
        return <WhatsAppIcon size={iconSize} />;
    }
  };

  const toggleChat = () => {
    setShowChat(!showChat);
  };

  return (
    <div className="relative w-full h-full">
      {showChat && (
        <div style={chatWindowStyle} className="animate-fade-in">
          <div className="bg-gray-100 p-3 flex justify-between items-center rounded-t-lg border-b">
            <div className="font-medium">Chat</div>
            <div className="text-xs text-gray-500">Powered by Widgetify</div>
          </div>
          <div className="flex-grow p-3 overflow-y-auto">
            <div className="bg-gray-100 p-2 rounded-lg mb-2 max-w-[80%]">
              <p className="text-xs">How can I help you today?</p>
            </div>
          </div>
          <div className="p-3 border-t bg-gray-50 rounded-b-lg">
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="Type a message..."
                className="flex-grow text-xs p-2 border rounded"
                disabled
              />
              <button
                className="bg-gray-200 p-2 rounded"
                disabled
              >
                <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
      <div 
        style={buttonStyle} 
        className="hover:scale-105 hover:shadow-lg" 
        onClick={toggleChat}
      >
        {getIcon()}
      </div>
    </div>
  );
};

export default WidgetPreview;
